'use strict';

// --- GLOBALNE STAÅE ---
const initialQuestions = {
    poranek: [ {id:"m1", text:"Za co jestem dziÅ› wdziÄ™czny/a?"}, {id:"m2", text:"Jaki jest mÃ³j najwaÅ¼niejszy cel na dzisiaj?"}, {id:"m3", text:"JakÄ… pozytywnÄ… afirmacjÄ™ wybieram na dziÅ›?"} ],
    wieczor: [ {id:"e1", text:"Trzy dobre rzeczy, ktÃ³re siÄ™ dzisiaj wydarzyÅ‚y, toâ€¦"}, {id:"e2", text:"Czego nowego siÄ™ dzisiaj nauczyÅ‚em/am?"}, {id:"e3",text:"Za co jestem sobie dzisiaj wdziÄ™czny/a?"} ]
};
const initialHabits = ["Medytacja", "Ä†wiczenia fizyczne", "Czytanie ksiÄ…Å¼ki", "Nauka czegoÅ› nowego"];
const initialSentimentQuestions = [
    { id: 'health', question: 'ğŸ’ª Jak oceniasz swoje samopoczucie fizyczne?' }, 
    { id: 'mood', question: 'ğŸ˜Š Jak oceniam swÃ³j nastrÃ³j?' }, 
    { id: 'productivity', question: 'ğŸš€ Jak oceniam swojÄ… produktywnoÅ›Ä‡?' }
];
const quotes = [ 
    "Nawet najdalszÄ… podrÃ³Å¼ zaczyna siÄ™ od pierwszego kroku. ğŸŒ±", "BÄ…dÅº zmianÄ…, ktÃ³rÄ… pragniesz ujrzeÄ‡ w Å›wiecie. ğŸš€", "Jedynym sposobem na wielkÄ… pracÄ™ jest kochanie tego, co robisz. âœ¨"
];
const suggestedMorningQuestions = [
    "Jaka jedna rzecz sprawiÅ‚aby, Å¼e ten dzieÅ„ bÄ™dzie wspaniaÅ‚y?", "Jak mogÄ™ dzisiaj zadbaÄ‡ o swoje ciaÅ‚o i umysÅ‚?", "Z jakim nastawieniem chcÄ™ rozpoczÄ…Ä‡ ten dzieÅ„?", "Czego chcÄ™ siÄ™ dziÅ› nauczyÄ‡?", "Kto potrzebuje dzisiaj mojej dobroci?", "JakÄ… maÅ‚Ä… przyjemnoÅ›Ä‡ mogÄ™ sobie dziÅ› sprawiÄ‡?", "Jaki jest pierwszy krok w kierunku mojego duÅ¼ego celu?", "Jak mogÄ™ wyjÅ›Ä‡ ze swojej strefy komfortu?", "Czego nie mogÄ™ siÄ™ doczekaÄ‡ w dzisiejszym dniu?", "JakÄ… pozytywnÄ… energiÄ™ wnoszÄ™ do Å›wiata?", "Za jakÄ… trudnÄ… lekcjÄ™ z przeszÅ‚oÅ›ci jestem wdziÄ™czny?", "Jak mogÄ™ dziÅ› okazaÄ‡ miÅ‚oÅ›Ä‡ bliskiej osobie?", "Jaki problem mogÄ™ dziÅ› sprÃ³bowaÄ‡ rozwiÄ…zaÄ‡?", "Co mogÄ™ zrobiÄ‡, aby poczuÄ‡ siÄ™ bardziej zorganizowanym?", "Jaka myÅ›l dodaje mi siÅ‚y?", "Jakie sÄ… moje 3 priorytety na dziÅ›?", "Jak mogÄ™ byÄ‡ bardziej obecny/a w tej chwili?", "JakÄ… jednÄ… rzecz mogÄ™ odpuÅ›ciÄ‡?", "Co piÄ™knego dostrzegam wokÃ³Å‚ siebie w tej chwili?", "JakÄ… obietnicÄ™ skÅ‚adam sobie na ten dzieÅ„?"
];
const suggestedEveningQuestions = [
    "Co dzisiaj poszÅ‚o lepiej, niÅ¼ siÄ™ spodziewaÅ‚em/am?", "Kiedy czuÅ‚em/am siÄ™ dzisiaj najbardziej sobÄ…?", "Co dzisiaj wywoÅ‚aÅ‚o mÃ³j uÅ›miech?", "JakÄ… jednÄ… rzecz zrobiÅ‚bym/zrobiÅ‚abym inaczej?", "Kto mi dzisiaj pomÃ³gÅ‚ lub kogo ja wsparÅ‚em/wsparÅ‚am?", "W jaki sposÃ³b ruszyÅ‚em/am do przodu w kierunku moich celÃ³w?", "Co dzisiaj mnie zaskoczyÅ‚o?", "Czego siÄ™ dzisiaj pozbyÅ‚em/pozbyÅ‚am (np. zÅ‚ego nawyku, negatywnej myÅ›li)?", "Jaka byÅ‚a najpiÄ™kniejsza rzecz, ktÃ³rÄ… dziÅ› widziaÅ‚em/widziaÅ‚am?", "O czym nowym dziÅ› myÅ›laÅ‚em/myÅ›laÅ‚am?", "Jakie uczucie dominowaÅ‚o w moim dniu?", "Co mogÄ™ zrobiÄ‡ jutro, aby byÅ‚o jeszcze lepsze?", "Kiedy czuÅ‚em/am siÄ™ najbardziej zrelaksowany/a?", "Jaka piosenka pasowaÅ‚aby do dzisiejszego dnia?", "Czego nauczyÅ‚a mnie dzisiejsza poraÅ¼ka lub wyzwanie?", "Za co chciaÅ‚bym/chciaÅ‚abym sobie podziÄ™kowaÄ‡?", "Jakie maÅ‚e zwyciÄ™stwo dzisiaj odniosÅ‚em/odniosÅ‚am?", "Jak oceniÅ‚bym/oceniÅ‚abym dziÅ› swojÄ… cierpliwoÅ›Ä‡?", "Co dobrego zjadÅ‚em/zjadÅ‚am?", "Z jakÄ… myÅ›lÄ… chcÄ™ zasnÄ…Ä‡?"
];

let currentQuestions, currentHabits, currentSentimentQuestions, currentDate, isAppInitialized = false;

// --- KLASY ---
class AppStorage {
    static get(key) { try { return JSON.parse(localStorage.getItem(key)); } catch (e) { return null; } }
    static set(key, value) { try { localStorage.setItem(key, JSON.stringify(value)); } catch(e) { console.error("BÅ‚Ä…d zapisu do localStorage", e); } }
    static userKey(prefix) { return `dg_${prefix}_${sessionStorage.getItem('dg_user')}`; }
    static getDayEntry(date) { return this.get(this.userKey(`entry_${date}`)) || {}; }
    static saveDayEntry(date, entry) { this.set(this.userKey(`entry_${date}`), entry); showNotification("Auto-zapisano âœ…"); }
    static getSetting(key) { const s = this.get(this.userKey('settings')); return s ? s[key] : null; }
    static setSetting(key, value) { const s = this.get(this.userKey('settings')) || {}; s[key] = value; this.set(this.userKey('settings'), s); }
    static getQuestions() { return this.get(this.userKey('questions')) || initialQuestions; }
    static saveQuestions(q) { this.set(this.userKey('questions'), q); }
    static getHabits() { return this.get(this.userKey('habits')) || initialHabits; }
    static saveHabits(h) { this.set(this.userKey('habits'), h); }
    static getSentimentQuestions() { return this.get(this.userKey('sentiments')) || initialSentimentQuestions; }
    static saveSentimentQuestions(sq) { this.set(this.userKey('sentiments'), sq); }
}

class UI {
    static buildSection(sectionId, title, emoji, containerSelector) {
        const panel = document.querySelector(containerSelector);
        if (!panel) return;
        const questions = currentQuestions[sectionId] || [];
        let html = `<div class="content-card"><h2 class="content-header">${emoji} ${title}</h2><div>`;
        questions.forEach(q => {
            html += `
                <div class="question-group">
                    <div class="label-with-inspire">
                        <label for="q-${q.id}">${q.text}</label>
                        <button class="btn inspire-btn" data-question-id="${q.id}" data-section="${sectionId}">Zainspiruj mnie</button>
                    </div>
                    <textarea id="q-${q.id}" data-id="${q.id}"></textarea>
                </div>
            `;
        });
        if (sectionId === 'wieczor') {
            html += currentSentimentQuestions.map(sq => `<div class="question